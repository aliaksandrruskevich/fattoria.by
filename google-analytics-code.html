<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C279E20DBY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C279E20DBY');
  
  // Enhanced Measurement - –≤–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  gtag('config', 'G-C279E20DBY', {
    'send_page_view': true,
    'page_title': document.title,
    'page_location': window.location.href
  });
</script>

<!-- Google Analytics —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ñ–æ—Ä–º -->
<script>
// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π
window.sendGAEvent = function(eventName, params) {
    if (typeof gtag !== 'undefined') {
        gtag('event', eventName, params);
        console.log('üìä Google Analytics: —Å–æ–±—ã—Ç–∏–µ "' + eventName + '" –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
        return true;
    }
    return false;
};

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º
window.trackGAFormSubmission = function(formType, formName, phone, source, value) {
    const eventParams = {
        'event_category': 'form',
        'event_label': formType,
        'value': value || 1,
        'form_name': formName || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
        'form_type': formType,
        'phone': phone || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
        'source': source || window.location.pathname,
        'page_url': window.location.href,
        'timestamp': new Date().toISOString()
    };
    
    // –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
    sendGAEvent('form_submit', eventParams);
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–æ—Ä–º
    if (formType.includes('consult')) sendGAEvent('consultation_request', eventParams);
    if (formType.includes('callback')) sendGAEvent('callback_request', eventParams);
    if (formType.includes('newbuild')) sendGAEvent('newbuilding_request', eventParams);
    if (formType.includes('project')) sendGAEvent('project_request', eventParams);
    
    // –î–ª—è Google Ads –∫–æ–Ω–≤–µ—Ä—Å–∏–π
    if (typeof gtag_report_conversion === 'function') {
        gtag_report_conversion();
    }
    
    return eventParams;
};

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–æ—Ä–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
document.addEventListener('DOMContentLoaded', function() {
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ñ–æ—Ä–º—ã
    const forms = document.querySelectorAll('form');
    
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const formData = new FormData(form);
            const formType = form.dataset.formType || 
                            form.getAttribute('id') || 
                            form.getAttribute('class') || 
                            'general_form';
            
            const name = formData.get('name') || '';
            const phone = formData.get('phone') || '';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ GA
            trackGAFormSubmission(formType, name, phone, 'direct_form');
        });
    });
});
</script>
